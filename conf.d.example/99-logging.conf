# Container-friendly logging profile.
pid_filename /var/run/squid/squid.pid

logformat detailed ts=%{%Y-%m-%dT%H:%M:%S%z}tl sn=%sn tr_ms=%tr src=%>a:%>p dst=%<A:%<p method=%rm url="%ru" code=%>Hs squid=%Ss bytes=%<st hier=%Sh err=%err_code/%err_detail ua="%{User-Agent}>h"

# Guard http_status checks to avoid "used in context without an HTTP response" warnings.
acl has_request has request
acl has_response has response
acl denied_status http_status 400-599
acl denied_response all-of has_response denied_status
acl non_denied_response all-of has_response !denied_status

# Split logs by traffic type/result for simpler analysis.
access_log stdio:/var/log/squid/access.log logformat=squid rotate=7
access_log stdio:/var/log/squid/denied.log logformat=detailed rotate=7 denied_response
access_log stdio:/var/log/squid/connect.log logformat=detailed rotate=7 has_request CONNECT non_denied_response
access_log stdio:/var/log/squid/http.log logformat=detailed rotate=7 has_request !CONNECT non_denied_response

# Keep cache log quiet; keep store events on stdout for docker logs.
cache_log stdio:/dev/null
cache_store_log stdio:/dev/stdout
